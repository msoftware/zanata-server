<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core">

  <div class="panels--2 panel__active-2">
    <div class="g--collapsed">
      <div class="g__item w--1-2 w--1-2-s panels__panel">
        <div class="bg--pop-high">
          <div class="panels__panel__header">
            <div class="g--tight">
              <div class="g__item w--1-2 w--1-2-s">
                <h2 class="heading--secondary epsilon">
                  <i class="i i--project l--push-right-quarter"></i>
                  #{messages['jsf.Projects']}
                </h2>
              </div>
              <div
                class="g__item w--1-2 w--1-2-s txt--align-right txt--s-align-right">
                <zanata:sortlist id="projects-project_sorting"
                  sortAction="#{versionGroupHomeAction.sortProjectList()}"
                  render="projects-project_list"
                  sortingList="#{versionGroupHomeAction.projectSortingList}"/>
              </div>
            </div>
          </div>
          <h:form id="projects-project_list">
            <s:fragment
              rendered="#{versionGroupHomeAction.getProjectIterations().isEmpty()}">
              <div class="l--pad-all-half">
                <p class="txt--meta">#{messages['jsf.NoProjectsInGroup']}</p>

                <s:fragment
                  rendered="#{s:hasPermission(versionGroupHome.instance, 'update')}">
                  <p>
                    <a href="#settings" class="button--primary">
                      #{messages['jsf.AddProjectVersions']}
                    </a>
                  </p>
                </s:fragment>
              </div>
            </s:fragment>
            <s:fragment
              rendered="#{!versionGroupHomeAction.getProjectIterations().isEmpty()}">
              <ul class="list--stats">
                <ui:repeat
                  value="#{versionGroupHomeAction.getProjectIterations()}"
                  var="version">
                  <li
                    class="progress-bar__expander panels__panel__item bg--highest--hover">
                    <a4j:commandLink
                      action="#{versionGroupHomeAction.setSelectedVersion(version)}"
                      render="projects-language_list, projectLabel"
                      onclick="updateActiveRow(this), toggleColumn()">
                      <div class="list__item">
                        <div class="list__item__info">
                          <span class="list__title">
                            #{version.project.slug}
                            <i class="i i--version"></i> #{version.slug}
                          </span>
                        </div>
                        <s:div styleClass="list__item__stats"
                          rendered="#{versionGroupHomeAction.pageRendered}">
                         <span class="stats--small txt--state-neutral">
                            <span class="stats__figure">
                              ${versionGroupHomeAction.getStatisticFigureForProject(versionGroupHomeAction.projectSortingList.selectedSortOption, version.id)}
                            </span>
                            <span class="stats__unit txt--lowercase">
                              ${versionGroupHomeAction.getStatisticUnit(versionGroupHomeAction.projectSortingList.selectedSortOption)}
                            </span>
                          </span>
                        </s:div>
                      </div>
                      <zanata:statistic
                        value="${versionGroupHomeAction.getStatisticForProject(version.id)}"
                        rendered="#{versionGroupHomeAction.pageRendered}"/>

                      <zanata:loader type="large"
                        rendered="#{!versionGroupHomeAction.pageRendered}"/>
                    </a4j:commandLink>
                  </li>
                </ui:repeat>
              </ul>
            </s:fragment>
          </h:form>
        </div>
      </div>

      <div class="g__item w--1-2 w--1-2-s panels__panel is-active">
        <s:div styleClass="bg--pop-higher">
          <div class="panels__panel__header">
            <div class="g--tight">
              <div class="g__item w--1-2 w--1-2-s">
                <h2 class="heading--secondary epsilon">
                    <span class="is-hidden--l-up">
                      <a href="#" onclick="toggleColumn()">
                        #{messages['jsf.Projects']}
                      </a>
                      <i class="i i--arrow-right"></i>
                    </span>
                  <i class="i i--language l--push-right-quarter"></i>
                  <a4j:outputPanel id="projectLabel">
                    #{versionGroupHomeAction.selectedVersion.project.slug}
                  </a4j:outputPanel>
                  #{messages['Languages']}
                </h2>
              </div>
              <div
                class="g__item w--1-2 w--1-2-s txt--align-right txt--s-align-right">
                <zanata:sortlist id="projects-language_sorting"
                  sortAction="#{versionGroupHomeAction.sortLanguageList()}"
                  render="projects-language_list"
                  sortingList="#{versionGroupHomeAction.languageSortingList}"/>
              </div>
            </div>
          </div>
          <h:form id="projects-language_list">
            <s:fragment
              rendered="#{versionGroupHomeAction.selectedVersion == null}">
              <div class="l--pad-all-half">
                <p class="txt--meta">
                  #{messages['jsf.SelectAProjectFromList']}
                </p>
              </div>
            </s:fragment>
            <s:fragment
              rendered="#{versionGroupHomeAction.getActiveLocales().isEmpty()}">
              <div class="l--pad-all-half">
                <p class="txt--meta">#{messages['jsf.NoActiveLanguages']}</p>
                <s:fragment
                  rendered="#{s:hasPermission(versionGroupHome.instance, 'update')}">
                  <p>
                    <a href="#settings" class="button--primary">
                      #{messages['jsf.AddLanguages']}
                    </a>
                  </p>
                </s:fragment>
              </div>
            </s:fragment>
            <s:fragment
              rendered="#{versionGroupHomeAction.selectedVersion != null and !versionGroupHomeAction.getActiveLocales().isEmpty()}">
              <ul class="list--stats">
                <ui:repeat
                  value="#{versionGroupHomeAction.getActiveLocales()}"
                  var="locale">
                  <li
                    class="progress-bar__expander panels__panel__item bg--highest--hover">
                    <a href="#">
                      <div class="list__item">
                        <div class="list__item__info">
                          <span class="list__title">
                            <span class="list__title">
                            <s:link view="/language/language.xhtml"
                              propagation="none"
                              value="${locale.retrieveDisplayName()}">
                              <f:param name="id" value="#{locale.localeId.id}"/>
                            </s:link>
                          </span>
                          </span>
                        </div>
                        <div class="list__item__stats">
                          <span class="stats--small">
                            <span class="stats__figure">
                              ${versionGroupHomeAction.getStatisticFigureForProjectWithLocale(versionGroupHomeAction.languageSortingList.selectedSortOption, locale.localeId, versionGroupHomeAction.selectedVersion.id)}
                            </span>
                            <span class="stats__unit txt--lowercase">
                              ${versionGroupHomeAction.getStatisticUnit(versionGroupHomeAction.languageSortingList.selectedSortOption)}
                            </span>
                          </span>
                        </div>
                      </div>
                      <zanata:statistic
                        value="${versionGroupHomeAction.getSelectedVersionStatistic(locale.localeId)}"/>
                    </a>
                  </li>
                </ui:repeat>
              </ul>
            </s:fragment>
          </h:form>
        </s:div>
      </div>
    </div>
  </div>


  <s:link styleClass="action_link" view="/version-group/request_to_join.xhtml"
    value="#{messages['jsf.RequestToJoinVersionGroup']}" propagation="none"
    rendered="#{versionGroupHomeAction.isUserProjectMaintainer()}">
    <f:param name="emailType" value="request_to_join_group"/>
    <f:param name="versionGroupSlug"
      value="#{versionGroupHomeAction.slug}"/>
  </s:link>

</ui:composition>