<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core">

  <script type="text/javascript">
    function update_activeRow(clickedElement) {
      jQuery(clickedElement).parent().siblings().removeClass('is-active');
      jQuery(clickedElement).parent().addClass('is-active');
    }

    function toggleColumn() {
      jQuery('.panels--2').toggleClass('panel__active-2');
    }
  </script>

  <div class="panels--2 panel__active-2">
    <div class="g--collapsed">
      <div class="g__item w--1-2 w--1-2-s panels__panel">
        <div class="bg--pop-high">
          <div class="panels__panel__header">
            <div class="g--tight">
              <div class="g__item w--1-2 w--1-2-s">
                <h2 class="heading--secondary epsilon">
                  <i class="i i--language l--push-right-quarter"></i>
                  #{messages['jsf.Languages']}
                </h2>
              </div>
              <div
                class="g__item w--1-2 w--1-2-s txt--align-right txt--s-align-right">

                <zanata:sortlist id="language_sorting"
                  sortAction="#{versionGroupHomeAction.sortLanguageList()}"
                  render="language_list"
                  sortingList="#{versionGroupHomeAction.languageSortingList}"/>
              </div>
            </div>
          </div>
          <h:form id="language_list">
            <s:fragment
              rendered="#{versionGroupHomeAction.getActiveLocales().isEmpty()}">
              <div class="l--pad-all-half">
                <p class="txt--meta">#{messages['jsf.NoActiveLanguages']}</p>

                <p><a href="#"
                  class="button--primary">#{messages['jsf.AddLanguages']}</a>
                </p>
              </div>
            </s:fragment>

            <s:fragment
              rendered="#{!versionGroupHomeAction.getActiveLocales().isEmpty()}">
              <ul class="list--stats">
                <ui:repeat
                  value="#{versionGroupHomeAction.getActiveLocales()}"
                  var="locale">
                  <li
                    class="progress-bar__expander panels__panel__item bg--highest--hover">
                    <a4j:commandLink
                      action="#{versionGroupHomeAction.setSelectedLocale(locale)}"
                      render="projects_column"
                      onclick="update_activeRow(this), toggleColumn()">
                      <div class="list__item">
                        <div class="list__item__info">
                          <span class="list__title">
                            ${locale.retrieveDisplayName()}
                          </span>
                        </div>
                        <s:div styleClass="list__item__stats"
                          rendered="#{versionGroupHomeAction.pageRendered}">
                         <span class="stats--small txt--state-neutral">
                            <span class="stats__figure">
                              ${versionGroupHomeAction.getStatisticFigure(versionGroupHomeAction.languageSortingList.selectedSortOption, locale.localeId)}
                            </span>
                            <span class="stats__unit txt--lowercase">
                              ${versionGroupHomeAction.getStatisticUnit(versionGroupHomeAction.languageSortingList.selectedSortOption)}
                            </span>
                          </span>
                        </s:div>
                      </div>

                      <zanata:statistic
                        value="${versionGroupHomeAction.getStatisticForLocale(locale.localeId)}"
                        rendered="#{versionGroupHomeAction.pageRendered}"/>

                      <zanata:loader type="large"
                        rendered="#{!versionGroupHomeAction.pageRendered}"/>
                    </a4j:commandLink>
                  </li>
                </ui:repeat>
              </ul>
            </s:fragment>
          </h:form>
        </div>
      </div>

      <div class="g__item w--1-2 w--1-2-s panels__panel is-active">
        <s:div styleClass="bg--pop-higher" id="projects_column">
          <s:fragment
            rendered="#{versionGroupHomeAction.selectedLocale != null}">
            <div class="panels__panel__header">
              <div class="g--tight">
                <div class="g__item w--1-2 w--1-2-s">
                  <h2 class="heading--secondary epsilon">
                  <span class="is-hidden--l-up">
                    <a href="#" onclick="toggleColumn()">
                      #{messages['jsf.Languages']}
                    </a>
                    <i class="i i--arrow-right"></i>
                  </span>
                    <i class="i i--project l--push-right-quarter"></i>
                    #{versionGroupHomeAction.selectedLocale.retrieveDisplayName()}
                    #{messages['Projects']}
                  </h2>
                </div>
                <div
                  class="g__item w--1-2 w--1-2-s txt--align-right txt--s-align-right">
                  <zanata:sortlist id="project_sorting"
                    sortAction="#{versionGroupHomeAction.sortProjectList()}"
                    render="project_list"
                    sortingList="#{versionGroupHomeAction.projectSortingList}"/>
                </div>
              </div>
            </div>
            <h:form id="project_list">
              <s:fragment
                rendered="#{versionGroupHomeAction.selectedLocale != null and !versionGroupHomeAction.getProjectIterations().isEmpty()}">
                <ul class="list--stats">
                  <ui:repeat
                    value="#{versionGroupHomeAction.getProjectIterations()}"
                    var="version">
                    <li
                      class="progress-bar__expander panels__panel__item bg--highest--hover">
                      <a href="#">
                        <div class="list__item">
                          <div class="list__item__info">
                          <span class="list__title">#{version.project.name}
                            <i class="i i--version"></i> #{version.slug}
                          </span>
                          </div>
                          <div class="list__item__stats">
                          <span class="stats--small">
                            <span class="stats__figure">
                              ${versionGroupHomeAction.getStatisticFigure(versionGroupHomeAction.projectSortingList.selectedSortOption, versionGroupHomeAction.selectedLocale.localeId)}
                            </span>
                            <span class="stats__unit txt--lowercase">
                              ${versionGroupHomeAction.getStatisticUnit(versionGroupHomeAction.projectSortingList.selectedSortOption)}
                            </span>
                          </span>
                          </div>
                        </div>
                        <zanata:statistic
                          value="${versionGroupHomeAction.getSelectedLocaleStatistic(version.id)}"/>
                      </a>
                    </li>
                  </ui:repeat>
                </ul>
              </s:fragment>
              <s:fragment
                rendered="#{versionGroupHomeAction.selectedLocale == null}">
                <div class="l--pad-all-half">
                  <p class="txt--meta">
                    #{messages['jsf.SelectALanguageFromList']}
                  </p>
                </div>
              </s:fragment>
              <s:fragment
                rendered="#{versionGroupHomeAction.getProjectIterations().isEmpty()}">
                <div class="l--pad-all-half">
                  <p class="txt--meta">#{messages['jsf.NoProjectsInGroup']}</p>

                  <p>
                    <a href="#" class="button--primary">
                      #{messages['jsf.AddProjectVersions']}
                    </a>
                  </p>
                </div>
              </s:fragment>
            </h:form>
          </s:fragment>
        </s:div>
      </div>
    </div>
  </div>
</ui:composition>
